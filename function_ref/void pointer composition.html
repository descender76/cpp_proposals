<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>void* composition</title>
  <meta name="description" content="void* composition">
  <meta name="author" content="Jarrad Waterloo">
  <style>
    h1
	{
	  text-align : center;
	}
	.code
	{
	  background-color: AliceBlue;
	}
	table.simple
	{
		border: 1px solid black;
		border-collapse: collapse;
	}
	table.simple > thead > tr > th
	{
		border: 1px solid black;
	}
	table.simple > tbody > tr > td
	{
		border: 1px solid black;
	}
	.problem
	{
		font-weight : bold;
		color : red;
	}
  </style>
</head>
<body>
<h1>void* composition</h1>
<table style="width:100%">
<tr>
<td>&nbsp;</td>
<td style="width:60ex">
  <table>
  <tr>
  <td><b>Document #:</b></td><td>PTODOR0</td>
  </tr>
  <tr>
  <td><b>Date:</b></td><td>2021-10-03</td>
  </tr>
  <tr>
  <td><b>Project:</b></td><td>Programming Language C++</td>
  </tr>
  <tr>
  <td><b>Audience:</b></td><td>Evolution Working Group (EWG)</td>
  </tr>
  <tr>
  <td><b>Reply-to:</b></td><td>Jarrad J. Waterloo<br/>&lt;<a href="mailto:descender76@gmail.com">descender76@gmail.com</a>&gt;</td>
  </tr>
  </table>
</td>
</tr>
</table>
<h2>Contents</h2>
<h3><a href="#request">1&nbsp;&nbsp;Request</a></h3>
<h3><a href="#usage">2&nbsp;&nbsp;Usage</a></h3>
<h3><a href="#why">3&nbsp;&nbsp;Why bother? What do we gain?</a></h3>
<h3><a href="#between">4&nbsp;&nbsp;The great between</a></h3>
<!--
<h3><a href="#acknowledgments">3&nbsp;&nbsp;Acknowledgments</a></h3>
-->
<!--
<h3><a href="#faq">4&nbsp;&nbsp;Frequently Asked Questions</a></h3>
<h4><a href="#ecx">4.1&nbsp;&nbsp;&nbsp;What about ECX?</a></h4>
<h4><a href="#deducing-this">4.2&nbsp;&nbsp;&nbsp;How does this relate to Deducing this?</a></h4>
<h4><a href="#void">4.3&nbsp;&nbsp;&nbsp;How might this combine with composite void*/guaranteed inlining?</a></h4>
-->
<h3><a href="#references">5&nbsp;&nbsp;References</a></h3>
<h2 id="request">Request</h2>
<p>Following current void* semantics, allow the following:</p>
<ol>
<li>free function pointers can be implicitly cast to other free function pointer types where one or more of its parameters or return value types that are pointers or lvalue references has been replaced with void*</li>
<li>free function pointers can be explicitly cast to other free function pointer types where one or more of its parameters or return value types that are void pointers has been replaced with any other pointer or lvalue reference type</li>
<li>it is not undefined behavior that the type erased free function pointers can called provided the caller ensures the correct parameter types are passed</li>
</ol>
<h2 id="usage">Usage: type erased free functions</h2>
<!-- composite-void-pointer-usage.cc.html -->
<div class="code">
<!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><b><font color="#000080">#include</font></b> <font color="#FF0000">&lt;iostream&gt;</font>

<b><font color="#0000FF">struct</font></b> <font color="#008080">fully_typed</font> <font color="#FF0000">{</font>
    <font color="#009900">bool</font> b1<font color="#990000">;</font>
    <font color="#009900">bool</font><font color="#990000">*</font> b2<font color="#990000">;</font>
    <font color="#009900">int</font> i1<font color="#990000">;</font>
    <font color="#009900">int</font><font color="#990000">*</font> i2<font color="#990000">;</font>
    <font color="#009900">float</font> f1<font color="#990000">;</font>
    <font color="#009900">float</font><font color="#990000">*</font> f2<font color="#990000">;</font>
<font color="#FF0000">}</font><font color="#990000">;</font>

<i><font color="#9A1900">// This class is intended by the programmer to have</font></i>
<i><font color="#9A1900">// the same size, alignment and layout as fully_typed</font></i>
<b><font color="#0000FF">struct</font></b> <font color="#008080">partially_typed</font> <font color="#FF0000">{</font>
    <font color="#009900">bool</font> b1<font color="#990000">;</font>
    <font color="#009900">void</font><font color="#990000">*</font> b2<font color="#990000">;</font>
    <font color="#009900">int</font> i1<font color="#990000">;</font>
    <font color="#009900">void</font><font color="#990000">*</font> i2<font color="#990000">;</font>
    <font color="#009900">float</font> f1<font color="#990000">;</font>
    <font color="#009900">void</font><font color="#990000">*</font> f2<font color="#990000">;</font>
<font color="#FF0000">}</font><font color="#990000">;</font>

<b><font color="#0000FF">template</font></b><font color="#990000">&lt;</font><b><font color="#0000FF">class</font></b> <font color="#008080">B</font><font color="#990000">,</font> <b><font color="#0000FF">class</font></b> <font color="#008080">I</font><font color="#990000">,</font> <b><font color="#0000FF">class</font></b> <font color="#008080">F</font><font color="#990000">&gt;</font>
<b><font color="#0000FF">struct</font></b> <font color="#008080">templated_typed</font> <font color="#FF0000">{</font>
    <font color="#009900">bool</font> b1<font color="#990000">;</font>
    B<font color="#990000">*</font> b2<font color="#990000">;</font>
    <font color="#009900">int</font> i1<font color="#990000">;</font>
    I<font color="#990000">*</font> i2<font color="#990000">;</font>
    <font color="#009900">float</font> f1<font color="#990000">;</font>
    F<font color="#990000">*</font> f2<font color="#990000">;</font>
<font color="#FF0000">}</font><font color="#990000">;</font>

<font color="#009900">void</font> <b><font color="#000000">fully_typed_f1</font></b><font color="#990000">(</font>fully_typed<font color="#990000">*</font> ft<font color="#990000">)</font>
<font color="#FF0000">{</font>
    std<font color="#990000">::</font>cout <font color="#990000">&lt;&lt;</font> ft<font color="#990000">-&gt;</font>b1 <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> <font color="#990000">*</font>ft<font color="#990000">-&gt;</font>b2
        <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> ft<font color="#990000">-&gt;</font>i1 <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> <font color="#990000">*</font>ft<font color="#990000">-&gt;</font>i2
        <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> ft<font color="#990000">-&gt;</font>f1 <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> <font color="#990000">*</font>ft<font color="#990000">-&gt;</font>f2
        <font color="#990000">&lt;&lt;</font> std<font color="#990000">::</font>endl<font color="#990000">;</font>
<font color="#FF0000">}</font>

<font color="#009900">void</font> <b><font color="#000000">fully_typed_f2</font></b><font color="#990000">(</font>templated_typed<font color="#990000">&lt;</font><font color="#009900">bool</font><font color="#990000">,</font> <font color="#009900">int</font><font color="#990000">,</font> <font color="#009900">float</font><font color="#990000">&gt;*</font> ft<font color="#990000">)</font>
<font color="#FF0000">{</font>
    std<font color="#990000">::</font>cout <font color="#990000">&lt;&lt;</font> ft<font color="#990000">-&gt;</font>b1 <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> <font color="#990000">*</font>ft<font color="#990000">-&gt;</font>b2
        <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> ft<font color="#990000">-&gt;</font>i1 <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> <font color="#990000">*</font>ft<font color="#990000">-&gt;</font>i2
        <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> ft<font color="#990000">-&gt;</font>f1 <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> <font color="#990000">*</font>ft<font color="#990000">-&gt;</font>f2
        <font color="#990000">&lt;&lt;</font> std<font color="#990000">::</font>endl<font color="#990000">;</font>
<font color="#FF0000">}</font>

<font color="#009900">void</font> <b><font color="#000000">fully_typed_f3</font></b><font color="#990000">(</font><font color="#009900">bool</font> b1<font color="#990000">,</font> <font color="#009900">bool</font><font color="#990000">*</font> b2<font color="#990000">,</font> <font color="#009900">bool</font><font color="#990000">&amp;</font> b3<font color="#990000">,</font>
    <font color="#009900">int</font> i1<font color="#990000">,</font> <font color="#009900">int</font><font color="#990000">*</font> i2<font color="#990000">,</font> <font color="#009900">int</font><font color="#990000">&amp;</font> i3<font color="#990000">,</font>
    <font color="#009900">float</font> f1<font color="#990000">,</font> <font color="#009900">float</font><font color="#990000">*</font> f2<font color="#990000">,</font> <font color="#009900">float</font><font color="#990000">&amp;</font> f3<font color="#990000">)</font>
<font color="#FF0000">{</font>
    std<font color="#990000">::</font>cout <font color="#990000">&lt;&lt;</font> b1 <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> <font color="#990000">*</font>b2 <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> b3
        <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> i1 <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> <font color="#990000">*</font>i2 <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> i3
        <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> f1 <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> <font color="#990000">*</font>f2 <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> f3
        <font color="#990000">&lt;&lt;</font> std<font color="#990000">::</font>endl<font color="#990000">;</font>
<font color="#FF0000">}</font>

<b><font color="#0000FF">typedef</font></b> <font color="#009900">void</font> <font color="#990000">(*</font>strongfs<font color="#990000">)(</font><font color="#009900">bool</font><font color="#990000">,</font> <font color="#009900">bool</font><font color="#990000">*,</font> <font color="#009900">bool</font><font color="#990000">&amp;,</font> <font color="#009900">int</font><font color="#990000">,</font> <font color="#009900">int</font><font color="#990000">*,</font> <font color="#009900">int</font><font color="#990000">&amp;,</font> <font color="#009900">float</font><font color="#990000">,</font> <font color="#009900">float</font><font color="#990000">*,</font> <font color="#009900">float</font><font color="#990000">&amp;);</font>
<b><font color="#0000FF">typedef</font></b> <font color="#009900">void</font> <font color="#990000">(*</font>weakfs<font color="#990000">)(</font><font color="#009900">bool</font><font color="#990000">,</font> <font color="#009900">void</font><font color="#990000">*,</font> <font color="#009900">void</font><font color="#990000">*,</font> <font color="#009900">int</font><font color="#990000">,</font> <font color="#009900">void</font><font color="#990000">*,</font> <font color="#009900">void</font><font color="#990000">*,</font> <font color="#009900">float</font><font color="#990000">,</font> <font color="#009900">void</font><font color="#990000">*,</font> <font color="#009900">void</font><font color="#990000">*);</font>

<font color="#009900">int</font> <b><font color="#000000">main</font></b><font color="#990000">()</font>
<font color="#FF0000">{</font>
    <font color="#009900">void</font><font color="#990000">*</font> temp <font color="#990000">=</font> nullptr<font color="#990000">;</font>
    <font color="#009900">bool</font> b <font color="#990000">=</font> <b><font color="#0000FF">true</font></b><font color="#990000">;</font>
    <font color="#009900">int</font> i <font color="#990000">=</font> <font color="#993399">7</font><font color="#990000">;</font>
    <font color="#009900">float</font> f <font color="#990000">=</font> <font color="#993399">3.14</font><font color="#990000">;</font>
    <font color="#009900">bool</font><font color="#990000">&amp;</font> br <font color="#990000">=</font> b<font color="#990000">;</font>
    <font color="#009900">int</font><font color="#990000">&amp;</font> ir <font color="#990000">=</font> i<font color="#990000">;</font>
    <font color="#009900">float</font><font color="#990000">&amp;</font> fr <font color="#990000">=</font> f<font color="#990000">;</font>
    <font color="#008080">fully_typed</font> ft<font color="#FF0000">{</font>b<font color="#990000">,</font> <font color="#990000">&amp;</font>b<font color="#990000">,</font> i<font color="#990000">,</font> <font color="#990000">&amp;</font>i<font color="#990000">,</font> f<font color="#990000">,</font> <font color="#990000">&amp;</font>f<font color="#FF0000">}</font><font color="#990000">;</font>
    <font color="#008080">partially_typed</font> pt<font color="#FF0000">{</font>b<font color="#990000">,</font> <font color="#990000">&amp;</font>b<font color="#990000">,</font> i<font color="#990000">,</font> <font color="#990000">&amp;</font>i<font color="#990000">,</font> f<font color="#990000">,</font> <font color="#990000">&amp;</font>f<font color="#FF0000">}</font><font color="#990000">;</font>
    <font color="#008080">templated_typed&lt;bool, int, float&gt;</font> tt1<font color="#FF0000">{</font>b<font color="#990000">,</font> <font color="#990000">&amp;</font>b<font color="#990000">,</font> i<font color="#990000">,</font> <font color="#990000">&amp;</font>i<font color="#990000">,</font> f<font color="#990000">,</font> <font color="#990000">&amp;</font>f<font color="#FF0000">}</font><font color="#990000">;</font>
    <font color="#008080">templated_typed&lt;void, void, void&gt;</font> tt2<font color="#FF0000">{</font>b<font color="#990000">,</font> <font color="#990000">&amp;</font>b<font color="#990000">,</font> i<font color="#990000">,</font> <font color="#990000">&amp;</font>i<font color="#990000">,</font> f<font color="#990000">,</font> <font color="#990000">&amp;</font>f<font color="#FF0000">}</font><font color="#990000">;</font>
    temp <font color="#990000">=</font> <font color="#990000">&amp;</font>b<font color="#990000">;</font><i><font color="#9A1900">// current behavior in simple void* case</font></i>
    temp <font color="#990000">=</font> <font color="#990000">&amp;</font>i<font color="#990000">;</font><i><font color="#9A1900">// current behavior in simple void* case</font></i>
    temp <font color="#990000">=</font> <font color="#990000">&amp;</font>f<font color="#990000">;</font><i><font color="#9A1900">// current behavior in simple void* case</font></i>
    <i><font color="#9A1900">//error: incompatible integer to pointer conversion assigning to 'void *' from 'bool'</font></i>
    <i><font color="#9A1900">//temp = br;// desired behavior</font></i>
    <i><font color="#9A1900">//error: incompatible integer to pointer conversion assigning to 'void *' from 'int'</font></i>
    <i><font color="#9A1900">//temp = ir;// desired behavior</font></i>
    <i><font color="#9A1900">//error: assigning to 'void *' from incompatible type 'float'</font></i>
    <i><font color="#9A1900">//temp = fr;// desired behavior</font></i>
    <i><font color="#9A1900">// workaround</font></i>
    temp <font color="#990000">=</font> <font color="#990000">&amp;</font>br<font color="#990000">;</font><i><font color="#9A1900">// desired behavior</font></i>
    temp <font color="#990000">=</font> <font color="#990000">&amp;</font>ir<font color="#990000">;</font><i><font color="#9A1900">// desired behavior</font></i>
    temp <font color="#990000">=</font> <font color="#990000">&amp;</font>fr<font color="#990000">;</font><i><font color="#9A1900">// desired behavior</font></i>
    <b><font color="#000000">fully_typed_f1</font></b><font color="#990000">(&amp;</font>ft<font color="#990000">);</font>
    <i><font color="#9A1900">// error: static_cast from 'partially_typed *' to 'fully_typed *', which are not related by inheritance, is not allowed</font></i>
    <i><font color="#9A1900">// https://en.cppreference.com/w/c/language/type</font></i>
    <i><font color="#9A1900">// "Note: C++ has no concept of compatible types. A C program that declares two types that are compatible but not identical in different translation units is not a valid C++ program."</font></i>
    <i><font color="#9A1900">// fully_typed is not related partially_typed, so without compatible types a C++ programmer could not expect this to work</font></i>
    <i><font color="#9A1900">//fully_typed_f(static_cast&lt;fully_typed*&gt;(&amp;pt));</font></i>
    <i><font color="#9A1900">// workaround</font></i>
    <b><font color="#000000">fully_typed_f1</font></b><font color="#990000">(</font><b><font color="#0000FF">static_cast</font></b><font color="#990000">&lt;</font>fully_typed<font color="#990000">*&gt;(</font><b><font color="#0000FF">static_cast</font></b><font color="#990000">&lt;</font><font color="#009900">void</font><font color="#990000">*&gt;(&amp;</font>pt<font color="#990000">)));</font><i><font color="#9A1900">// definable undefined behavior</font></i>
    <b><font color="#000000">fully_typed_f2</font></b><font color="#990000">(&amp;</font>tt1<font color="#990000">);</font>
    <i><font color="#9A1900">// error: static_cast from 'templated_typed&lt;void, void, void&gt; *' to 'templated_typed&lt;bool, int, float&gt; *', which are not related by inheritance, is not allowed</font></i>
    <i><font color="#9A1900">// https://en.cppreference.com/w/c/language/type</font></i>
    <i><font color="#9A1900">// "Note: C++ has no concept of compatible types. A C program that declares two types that are compatible but not identical in different translation units is not a valid C++ program."</font></i>
    <i><font color="#9A1900">// templated_typed&lt;bool, int, float&gt; is related templated_typed&lt;void, void, void&gt;, so despite not having compatible types a C++ programmer could expect this to work</font></i>
    <i><font color="#9A1900">//fully_typed_f(static_cast&lt;templated_typed&lt;bool, int, float&gt;*&gt;(&amp;tt2));</font></i>
    <i><font color="#9A1900">// workaround</font></i>
    <b><font color="#000000">fully_typed_f2</font></b><font color="#990000">(</font><b><font color="#0000FF">static_cast</font></b><font color="#990000">&lt;</font>templated_typed<font color="#990000">&lt;</font><font color="#009900">bool</font><font color="#990000">,</font> <font color="#009900">int</font><font color="#990000">,</font> <font color="#009900">float</font><font color="#990000">&gt;*&gt;(</font><b><font color="#0000FF">static_cast</font></b><font color="#990000">&lt;</font><font color="#009900">void</font><font color="#990000">*&gt;(&amp;</font>tt2<font color="#990000">)));</font><i><font color="#9A1900">// definable undefined behavior</font></i>
    <b><font color="#000000">fully_typed_f3</font></b><font color="#990000">(</font>b<font color="#990000">,</font> <font color="#990000">&amp;</font>b<font color="#990000">,</font> b<font color="#990000">,</font> i<font color="#990000">,</font> <font color="#990000">&amp;</font>i<font color="#990000">,</font> i<font color="#990000">,</font> f<font color="#990000">,</font> <font color="#990000">&amp;</font>f<font color="#990000">,</font> f<font color="#990000">);</font>
    <font color="#008080">strongfs</font> fp1 <font color="#990000">=</font> fully_typed_f3<font color="#990000">;</font>
    <b><font color="#000000">fp1</font></b><font color="#990000">(</font>b<font color="#990000">,</font> <font color="#990000">&amp;</font>b<font color="#990000">,</font> b<font color="#990000">,</font> i<font color="#990000">,</font> <font color="#990000">&amp;</font>i<font color="#990000">,</font> i<font color="#990000">,</font> f<font color="#990000">,</font> <font color="#990000">&amp;</font>f<font color="#990000">,</font> f<font color="#990000">);</font>
    <i><font color="#9A1900">// error: address of overloaded function 'fully_typed_f' does not match required type 'void (bool, void *, void *, int, void *, void *, float, void *, void *)'</font></i>
    <i><font color="#9A1900">// desired behavior</font></i>
    <i><font color="#9A1900">//weakfs fp2 = fully_typed_f3;</font></i>
    <i><font color="#9A1900">// workaround</font></i>
    <font color="#008080">weakfs</font> fp2 <font color="#990000">=</font> <font color="#990000">(</font>weakfs<font color="#990000">)((</font><font color="#009900">void</font><font color="#990000">*)</font>fully_typed_f3<font color="#990000">);</font>
    <b><font color="#000000">fp2</font></b><font color="#990000">(</font>b<font color="#990000">,</font> <font color="#990000">&amp;</font>b<font color="#990000">,</font> <font color="#990000">&amp;</font>b<font color="#990000">,</font> i<font color="#990000">,</font> <font color="#990000">&amp;</font>i<font color="#990000">,</font> <font color="#990000">&amp;</font>i<font color="#990000">,</font> f<font color="#990000">,</font> <font color="#990000">&amp;</font>f<font color="#990000">,</font> <font color="#990000">&amp;</font>f<font color="#990000">);</font><i><font color="#9A1900">// definable undefined behavior</font></i>
<font color="#FF0000">}</font></tt></pre>

</div>
<h2 id="why">Why bother? What do we gain?</h2>
<ol>
<li>Core language support for type erased free functions</li>
<li>Removing some of the need to manually create binders for compatible types</li>
<li>Ease of use for not having to resort to templactes unnecessarily</li>
<li>Replace some undefined behavior in C++ with defined behavior</li>
</ol>
<h2 id="between">The great between</h2>
<!-- composite-void-pointer.cc.html -->
<div class="code">
<!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><b><font color="#000080">#include</font></b> <font color="#FF0000">&lt;iostream&gt;</font>

<b><font color="#0000FF">struct</font></b> <font color="#008080">fully_typed</font> <font color="#FF0000">{</font>
    <font color="#009900">bool</font> b1<font color="#990000">;</font>
    <font color="#009900">bool</font><font color="#990000">*</font> b2<font color="#990000">;</font>
    <font color="#009900">int</font> i1<font color="#990000">;</font>
    <font color="#009900">int</font><font color="#990000">*</font> i2<font color="#990000">;</font>
    <font color="#009900">float</font> f1<font color="#990000">;</font>
    <font color="#009900">float</font><font color="#990000">*</font> f2<font color="#990000">;</font>
<font color="#FF0000">}</font><font color="#990000">;</font>

<i><font color="#9A1900">// This class is intended by the programmer to have</font></i>
<i><font color="#9A1900">// the same size, alignment and layout as fully_typed</font></i>
<b><font color="#0000FF">struct</font></b> <font color="#008080">partially_typed</font> <font color="#FF0000">{</font>
    <font color="#009900">bool</font> b1<font color="#990000">;</font>
    <font color="#009900">void</font><font color="#990000">*</font> b2<font color="#990000">;</font>
    <font color="#009900">int</font> i1<font color="#990000">;</font>
    <font color="#009900">void</font><font color="#990000">*</font> i2<font color="#990000">;</font>
    <font color="#009900">float</font> f1<font color="#990000">;</font>
    <font color="#009900">void</font><font color="#990000">*</font> f2<font color="#990000">;</font>
<font color="#FF0000">}</font><font color="#990000">;</font>

<b><font color="#0000FF">template</font></b><font color="#990000">&lt;</font><b><font color="#0000FF">class</font></b> <font color="#008080">B</font><font color="#990000">,</font> <b><font color="#0000FF">class</font></b> <font color="#008080">I</font><font color="#990000">,</font> <b><font color="#0000FF">class</font></b> <font color="#008080">F</font><font color="#990000">&gt;</font>
<b><font color="#0000FF">struct</font></b> <font color="#008080">templated_typed</font> <font color="#FF0000">{</font>
    <font color="#009900">bool</font> b1<font color="#990000">;</font>
    B<font color="#990000">*</font> b2<font color="#990000">;</font>
    <font color="#009900">int</font> i1<font color="#990000">;</font>
    I<font color="#990000">*</font> i2<font color="#990000">;</font>
    <font color="#009900">float</font> f1<font color="#990000">;</font>
    F<font color="#990000">*</font> f2<font color="#990000">;</font>
<font color="#FF0000">}</font><font color="#990000">;</font>

<font color="#009900">void</font> <b><font color="#000000">fully_typed_f1</font></b><font color="#990000">(</font>fully_typed<font color="#990000">*</font> ft<font color="#990000">)</font>
<font color="#FF0000">{</font>
    std<font color="#990000">::</font>cout <font color="#990000">&lt;&lt;</font> ft<font color="#990000">-&gt;</font>b1 <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> <font color="#990000">*</font>ft<font color="#990000">-&gt;</font>b2
        <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> ft<font color="#990000">-&gt;</font>i1 <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> <font color="#990000">*</font>ft<font color="#990000">-&gt;</font>i2
        <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> ft<font color="#990000">-&gt;</font>f1 <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> <font color="#990000">*</font>ft<font color="#990000">-&gt;</font>f2
        <font color="#990000">&lt;&lt;</font> std<font color="#990000">::</font>endl<font color="#990000">;</font>
<font color="#FF0000">}</font>

<font color="#009900">void</font> <b><font color="#000000">fully_typed_f2</font></b><font color="#990000">(</font>templated_typed<font color="#990000">&lt;</font><font color="#009900">bool</font><font color="#990000">,</font> <font color="#009900">int</font><font color="#990000">,</font> <font color="#009900">float</font><font color="#990000">&gt;*</font> ft<font color="#990000">)</font>
<font color="#FF0000">{</font>
    std<font color="#990000">::</font>cout <font color="#990000">&lt;&lt;</font> ft<font color="#990000">-&gt;</font>b1 <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> <font color="#990000">*</font>ft<font color="#990000">-&gt;</font>b2
        <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> ft<font color="#990000">-&gt;</font>i1 <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> <font color="#990000">*</font>ft<font color="#990000">-&gt;</font>i2
        <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> ft<font color="#990000">-&gt;</font>f1 <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> <font color="#990000">*</font>ft<font color="#990000">-&gt;</font>f2
        <font color="#990000">&lt;&lt;</font> std<font color="#990000">::</font>endl<font color="#990000">;</font>
<font color="#FF0000">}</font>

<font color="#009900">void</font> <b><font color="#000000">fully_typed_f3</font></b><font color="#990000">(</font><font color="#009900">bool</font> b1<font color="#990000">,</font> <font color="#009900">bool</font><font color="#990000">*</font> b2<font color="#990000">,</font> <font color="#009900">bool</font><font color="#990000">&amp;</font> b3<font color="#990000">,</font>
    <font color="#009900">int</font> i1<font color="#990000">,</font> <font color="#009900">int</font><font color="#990000">*</font> i2<font color="#990000">,</font> <font color="#009900">int</font><font color="#990000">&amp;</font> i3<font color="#990000">,</font>
    <font color="#009900">float</font> f1<font color="#990000">,</font> <font color="#009900">float</font><font color="#990000">*</font> f2<font color="#990000">,</font> <font color="#009900">float</font><font color="#990000">&amp;</font> f3<font color="#990000">)</font>
<font color="#FF0000">{</font>
    std<font color="#990000">::</font>cout <font color="#990000">&lt;&lt;</font> b1 <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> <font color="#990000">*</font>b2 <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> b3
        <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> i1 <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> <font color="#990000">*</font>i2 <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> i3
        <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> f1 <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> <font color="#990000">*</font>f2 <font color="#990000">&lt;&lt;</font> <font color="#FF0000">","</font> <font color="#990000">&lt;&lt;</font> f3
        <font color="#990000">&lt;&lt;</font> std<font color="#990000">::</font>endl<font color="#990000">;</font>
<font color="#FF0000">}</font>

<b><font color="#0000FF">typedef</font></b> <font color="#009900">void</font> <font color="#990000">(*</font>strongfs<font color="#990000">)(</font><font color="#009900">bool</font><font color="#990000">,</font> <font color="#009900">bool</font><font color="#990000">*,</font> <font color="#009900">bool</font><font color="#990000">&amp;,</font> <font color="#009900">int</font><font color="#990000">,</font> <font color="#009900">int</font><font color="#990000">*,</font> <font color="#009900">int</font><font color="#990000">&amp;,</font> <font color="#009900">float</font><font color="#990000">,</font> <font color="#009900">float</font><font color="#990000">*,</font> <font color="#009900">float</font><font color="#990000">&amp;);</font>
<b><font color="#0000FF">typedef</font></b> <font color="#009900">void</font> <font color="#990000">(*</font>weakfs<font color="#990000">)(</font><font color="#009900">bool</font><font color="#990000">,</font> <font color="#009900">void</font><font color="#990000">*,</font> <font color="#009900">void</font><font color="#990000">*,</font> <font color="#009900">int</font><font color="#990000">,</font> <font color="#009900">void</font><font color="#990000">*,</font> <font color="#009900">void</font><font color="#990000">*,</font> <font color="#009900">float</font><font color="#990000">,</font> <font color="#009900">void</font><font color="#990000">*,</font> <font color="#009900">void</font><font color="#990000">*);</font>

<font color="#009900">int</font> <b><font color="#000000">main</font></b><font color="#990000">()</font>
<font color="#FF0000">{</font>
    <font color="#009900">void</font><font color="#990000">*</font> temp <font color="#990000">=</font> nullptr<font color="#990000">;</font>
    <font color="#009900">bool</font> b <font color="#990000">=</font> <b><font color="#0000FF">true</font></b><font color="#990000">;</font>
    <font color="#009900">int</font> i <font color="#990000">=</font> <font color="#993399">7</font><font color="#990000">;</font>
    <font color="#009900">float</font> f <font color="#990000">=</font> <font color="#993399">3.14</font><font color="#990000">;</font>
    <font color="#009900">bool</font><font color="#990000">&amp;</font> br <font color="#990000">=</font> b<font color="#990000">;</font>
    <font color="#009900">int</font><font color="#990000">&amp;</font> ir <font color="#990000">=</font> i<font color="#990000">;</font>
    <font color="#009900">float</font><font color="#990000">&amp;</font> fr <font color="#990000">=</font> f<font color="#990000">;</font>
    <font color="#008080">fully_typed</font> ft<font color="#FF0000">{</font>b<font color="#990000">,</font> <font color="#990000">&amp;</font>b<font color="#990000">,</font> i<font color="#990000">,</font> <font color="#990000">&amp;</font>i<font color="#990000">,</font> f<font color="#990000">,</font> <font color="#990000">&amp;</font>f<font color="#FF0000">}</font><font color="#990000">;</font>
    <font color="#008080">partially_typed</font> pt<font color="#FF0000">{</font>b<font color="#990000">,</font> <font color="#990000">&amp;</font>b<font color="#990000">,</font> i<font color="#990000">,</font> <font color="#990000">&amp;</font>i<font color="#990000">,</font> f<font color="#990000">,</font> <font color="#990000">&amp;</font>f<font color="#FF0000">}</font><font color="#990000">;</font>
    <font color="#008080">templated_typed&lt;bool, int, float&gt;</font> tt1<font color="#FF0000">{</font>b<font color="#990000">,</font> <font color="#990000">&amp;</font>b<font color="#990000">,</font> i<font color="#990000">,</font> <font color="#990000">&amp;</font>i<font color="#990000">,</font> f<font color="#990000">,</font> <font color="#990000">&amp;</font>f<font color="#FF0000">}</font><font color="#990000">;</font>
    <font color="#008080">templated_typed&lt;void, void, void&gt;</font> tt2<font color="#FF0000">{</font>b<font color="#990000">,</font> <font color="#990000">&amp;</font>b<font color="#990000">,</font> i<font color="#990000">,</font> <font color="#990000">&amp;</font>i<font color="#990000">,</font> f<font color="#990000">,</font> <font color="#990000">&amp;</font>f<font color="#FF0000">}</font><font color="#990000">;</font>
    temp <font color="#990000">=</font> <font color="#990000">&amp;</font>b<font color="#990000">;</font><i><font color="#9A1900">// current behavior in simple void* case</font></i>
    temp <font color="#990000">=</font> <font color="#990000">&amp;</font>i<font color="#990000">;</font><i><font color="#9A1900">// current behavior in simple void* case</font></i>
    temp <font color="#990000">=</font> <font color="#990000">&amp;</font>f<font color="#990000">;</font><i><font color="#9A1900">// current behavior in simple void* case</font></i>
    <i><font color="#9A1900">//error: incompatible integer to pointer conversion assigning to 'void *' from 'bool'</font></i>
    <i><font color="#9A1900">//temp = br;// desired behavior</font></i>
    <i><font color="#9A1900">//error: incompatible integer to pointer conversion assigning to 'void *' from 'int'</font></i>
    <i><font color="#9A1900">//temp = ir;// desired behavior</font></i>
    <i><font color="#9A1900">//error: assigning to 'void *' from incompatible type 'float'</font></i>
    <i><font color="#9A1900">//temp = fr;// desired behavior</font></i>
    <i><font color="#9A1900">// workaround</font></i>
    temp <font color="#990000">=</font> <font color="#990000">&amp;</font>br<font color="#990000">;</font><i><font color="#9A1900">// desired behavior</font></i>
    temp <font color="#990000">=</font> <font color="#990000">&amp;</font>ir<font color="#990000">;</font><i><font color="#9A1900">// desired behavior</font></i>
    temp <font color="#990000">=</font> <font color="#990000">&amp;</font>fr<font color="#990000">;</font><i><font color="#9A1900">// desired behavior</font></i>
    <b><font color="#000000">fully_typed_f1</font></b><font color="#990000">(&amp;</font>ft<font color="#990000">);</font>
    <i><font color="#9A1900">// error: static_cast from 'partially_typed *' to 'fully_typed *', which are not related by inheritance, is not allowed</font></i>
    <i><font color="#9A1900">// https://en.cppreference.com/w/c/language/type</font></i>
    <i><font color="#9A1900">// "Note: C++ has no concept of compatible types. A C program that declares two types that are compatible but not identical in different translation units is not a valid C++ program."</font></i>
    <i><font color="#9A1900">// fully_typed is not related partially_typed, so without compatible types a C++ programmer could not expect this to work</font></i>
    <i><font color="#9A1900">//fully_typed_f(static_cast&lt;fully_typed*&gt;(&amp;pt));</font></i>
    <i><font color="#9A1900">// workaround</font></i>
    <b><font color="#000000">fully_typed_f1</font></b><font color="#990000">(</font><b><font color="#0000FF">static_cast</font></b><font color="#990000">&lt;</font>fully_typed<font color="#990000">*&gt;(</font><b><font color="#0000FF">static_cast</font></b><font color="#990000">&lt;</font><font color="#009900">void</font><font color="#990000">*&gt;(&amp;</font>pt<font color="#990000">)));</font><i><font color="#9A1900">// definable undefined behavior</font></i>
    <b><font color="#000000">fully_typed_f2</font></b><font color="#990000">(&amp;</font>tt1<font color="#990000">);</font>
    <i><font color="#9A1900">// error: static_cast from 'templated_typed&lt;void, void, void&gt; *' to 'templated_typed&lt;bool, int, float&gt; *', which are not related by inheritance, is not allowed</font></i>
    <i><font color="#9A1900">// https://en.cppreference.com/w/c/language/type</font></i>
    <i><font color="#9A1900">// "Note: C++ has no concept of compatible types. A C program that declares two types that are compatible but not identical in different translation units is not a valid C++ program."</font></i>
    <i><font color="#9A1900">// templated_typed&lt;bool, int, float&gt; is related templated_typed&lt;void, void, void&gt;, so despite not having compatible types a C++ programmer could expect this to work</font></i>
    <i><font color="#9A1900">//fully_typed_f(static_cast&lt;templated_typed&lt;bool, int, float&gt;*&gt;(&amp;tt2));</font></i>
    <i><font color="#9A1900">// workaround</font></i>
    <b><font color="#000000">fully_typed_f2</font></b><font color="#990000">(</font><b><font color="#0000FF">static_cast</font></b><font color="#990000">&lt;</font>templated_typed<font color="#990000">&lt;</font><font color="#009900">bool</font><font color="#990000">,</font> <font color="#009900">int</font><font color="#990000">,</font> <font color="#009900">float</font><font color="#990000">&gt;*&gt;(</font><b><font color="#0000FF">static_cast</font></b><font color="#990000">&lt;</font><font color="#009900">void</font><font color="#990000">*&gt;(&amp;</font>tt2<font color="#990000">)));</font><i><font color="#9A1900">// definable undefined behavior</font></i>
    <b><font color="#000000">fully_typed_f3</font></b><font color="#990000">(</font>b<font color="#990000">,</font> <font color="#990000">&amp;</font>b<font color="#990000">,</font> b<font color="#990000">,</font> i<font color="#990000">,</font> <font color="#990000">&amp;</font>i<font color="#990000">,</font> i<font color="#990000">,</font> f<font color="#990000">,</font> <font color="#990000">&amp;</font>f<font color="#990000">,</font> f<font color="#990000">);</font>
    <font color="#008080">strongfs</font> fp1 <font color="#990000">=</font> fully_typed_f3<font color="#990000">;</font>
    <b><font color="#000000">fp1</font></b><font color="#990000">(</font>b<font color="#990000">,</font> <font color="#990000">&amp;</font>b<font color="#990000">,</font> b<font color="#990000">,</font> i<font color="#990000">,</font> <font color="#990000">&amp;</font>i<font color="#990000">,</font> i<font color="#990000">,</font> f<font color="#990000">,</font> <font color="#990000">&amp;</font>f<font color="#990000">,</font> f<font color="#990000">);</font>
    <i><font color="#9A1900">// error: address of overloaded function 'fully_typed_f' does not match required type 'void (bool, void *, void *, int, void *, void *, float, void *, void *)'</font></i>
    <i><font color="#9A1900">// desired behavior</font></i>
    <i><font color="#9A1900">//weakfs fp2 = fully_typed_f3;</font></i>
    <i><font color="#9A1900">// workaround</font></i>
    <font color="#008080">weakfs</font> fp2 <font color="#990000">=</font> <font color="#990000">(</font>weakfs<font color="#990000">)((</font><font color="#009900">void</font><font color="#990000">*)</font>fully_typed_f3<font color="#990000">);</font>
    <b><font color="#000000">fp2</font></b><font color="#990000">(</font>b<font color="#990000">,</font> <font color="#990000">&amp;</font>b<font color="#990000">,</font> <font color="#990000">&amp;</font>b<font color="#990000">,</font> i<font color="#990000">,</font> <font color="#990000">&amp;</font>i<font color="#990000">,</font> <font color="#990000">&amp;</font>i<font color="#990000">,</font> f<font color="#990000">,</font> <font color="#990000">&amp;</font>f<font color="#990000">,</font> <font color="#990000">&amp;</font>f<font color="#990000">);</font><i><font color="#9A1900">// definable undefined behavior</font></i>
<font color="#FF0000">}</font></tt></pre>

</div>
<!-- mfpi2fp.cc.html -->
<div class="code">
<!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><b><font color="#000080">#include</font></b> <font color="#FF0000">&lt;functional&gt;</font>

<b><font color="#0000FF">struct</font></b> <font color="#008080">bar</font> <font color="#FF0000">{</font>
    <font color="#009900">void</font> <b><font color="#000000">baz</font></b><font color="#990000">(</font><font color="#009900">bool</font> b<font color="#990000">,</font> <font color="#009900">int</font> i<font color="#990000">,</font> <font color="#009900">float</font> f<font color="#990000">)</font> <b><font color="#0000FF">noexcept</font></b><font color="#990000">(</font><b><font color="#0000FF">false</font></b><font color="#990000">)</font>
    <font color="#FF0000">{</font>
    <font color="#FF0000">}</font>
    <font color="#009900">void</font> <b><font color="#000000">baz</font></b><font color="#990000">(</font><font color="#009900">bool</font> b<font color="#990000">,</font> <font color="#009900">int</font> i<font color="#990000">,</font> <font color="#009900">float</font> f<font color="#990000">)</font> <b><font color="#0000FF">const</font></b> <b><font color="#0000FF">noexcept</font></b><font color="#990000">(</font><b><font color="#0000FF">false</font></b><font color="#990000">)</font>
    <font color="#FF0000">{</font>
    <font color="#FF0000">}</font>
    <font color="#009900">void</font> <b><font color="#000000">buz</font></b><font color="#990000">(</font><font color="#009900">bool</font> b<font color="#990000">,</font> <font color="#009900">int</font> i<font color="#990000">,</font> <font color="#009900">float</font> f<font color="#990000">)</font> <b><font color="#0000FF">noexcept</font></b><font color="#990000">(</font><b><font color="#0000FF">true</font></b><font color="#990000">)</font>
    <font color="#FF0000">{</font>
    <font color="#FF0000">}</font>
    <font color="#009900">void</font> <b><font color="#000000">buz</font></b><font color="#990000">(</font><font color="#009900">bool</font> b<font color="#990000">,</font> <font color="#009900">int</font> i<font color="#990000">,</font> <font color="#009900">float</font> f<font color="#990000">)</font> <b><font color="#0000FF">const</font></b> <b><font color="#0000FF">noexcept</font></b><font color="#990000">(</font><b><font color="#0000FF">true</font></b><font color="#990000">)</font>
    <font color="#FF0000">{</font>
    <font color="#FF0000">}</font>
<font color="#FF0000">}</font><font color="#990000">;</font>

<font color="#009900">void</font> <b><font color="#000000">free_bar_baz</font></b><font color="#990000">(</font>bar<font color="#990000">&amp;,</font> <font color="#009900">bool</font> b<font color="#990000">,</font> <font color="#009900">int</font> i<font color="#990000">,</font> <font color="#009900">float</font> f<font color="#990000">)</font> <b><font color="#0000FF">noexcept</font></b><font color="#990000">(</font><b><font color="#0000FF">false</font></b><font color="#990000">)</font>
<font color="#FF0000">{</font>
<font color="#FF0000">}</font>

<font color="#009900">void</font> <b><font color="#000000">free_bar_baz</font></b><font color="#990000">(</font><b><font color="#0000FF">const</font></b> bar<font color="#990000">&amp;,</font> <font color="#009900">bool</font> b<font color="#990000">,</font> <font color="#009900">int</font> i<font color="#990000">,</font> <font color="#009900">float</font> f<font color="#990000">)</font> <b><font color="#0000FF">noexcept</font></b><font color="#990000">(</font><b><font color="#0000FF">false</font></b><font color="#990000">)</font>
<font color="#FF0000">{</font>
<font color="#FF0000">}</font>

<font color="#009900">void</font> <b><font color="#000000">free_bar_buz</font></b><font color="#990000">(</font>bar<font color="#990000">&amp;,</font> <font color="#009900">bool</font> b<font color="#990000">,</font> <font color="#009900">int</font> i<font color="#990000">,</font> <font color="#009900">float</font> f<font color="#990000">)</font> <b><font color="#0000FF">noexcept</font></b><font color="#990000">(</font><b><font color="#0000FF">true</font></b><font color="#990000">)</font>
<font color="#FF0000">{</font>
<font color="#FF0000">}</font>

<font color="#009900">void</font> <b><font color="#000000">free_bar_buz</font></b><font color="#990000">(</font><b><font color="#0000FF">const</font></b> bar<font color="#990000">&amp;,</font> <font color="#009900">bool</font> b<font color="#990000">,</font> <font color="#009900">int</font> i<font color="#990000">,</font> <font color="#009900">float</font> f<font color="#990000">)</font> <b><font color="#0000FF">noexcept</font></b><font color="#990000">(</font><b><font color="#0000FF">true</font></b><font color="#990000">)</font>
<font color="#FF0000">{</font>
<font color="#FF0000">}</font>

<b><font color="#0000FF">template</font></b> <font color="#990000">&lt;</font><b><font color="#0000FF">typename</font></b> <font color="#008080">T</font><font color="#990000">,</font> T<font color="#990000">&gt;</font> <b><font color="#0000FF">struct</font></b> <font color="#008080">internal_member_function_traits</font><font color="#990000">;</font>

<b><font color="#0000FF">template</font></b> <font color="#990000">&lt;</font><b><font color="#0000FF">typename</font></b> <font color="#008080">T</font><font color="#990000">,</font> <b><font color="#0000FF">typename</font></b> <font color="#008080">R</font><font color="#990000">,</font> <b><font color="#0000FF">typename</font></b> <font color="#990000">...</font>Args<font color="#990000">,</font> <b><font color="#000000">R</font></b> <font color="#990000">(</font>T<font color="#990000">::*</font>mf<font color="#990000">)(</font>Args<font color="#990000">...)&gt;</font>
<b><font color="#0000FF">struct</font></b> <font color="#008080">internal_member_function_traits</font><font color="#990000">&lt;</font><b><font color="#000000">R</font></b> <font color="#990000">(</font>T<font color="#990000">::*)(</font>Args<font color="#990000">...),</font> mf<font color="#990000">&gt;</font>
<font color="#FF0000">{</font>
	<b><font color="#0000FF">typedef</font></b> <b><font color="#000000">R</font></b> <font color="#990000">(</font>this_as_ref_function_signature<font color="#990000">)(</font>T<font color="#990000">&amp;,</font> Args <font color="#990000">...</font> args<font color="#990000">);</font>
    <b><font color="#0000FF">static</font></b> <font color="#008080">R</font> <b><font color="#000000">this_as_ref</font></b><font color="#990000">(</font>T<font color="#990000">&amp;</font> first<font color="#990000">,</font> Args <font color="#990000">...</font> args<font color="#990000">)</font>
    <font color="#FF0000">{</font>
        <b><font color="#0000FF">return</font></b> <font color="#990000">(</font>first<font color="#990000">.*</font>mf<font color="#990000">)(</font>std<font color="#990000">::</font>forward<font color="#990000">&lt;</font>Args<font color="#990000">&gt;(</font>args<font color="#990000">)...);</font>
    <font color="#FF0000">}</font>
<font color="#FF0000">}</font><font color="#990000">;</font>

<b><font color="#0000FF">template</font></b> <font color="#990000">&lt;</font><b><font color="#0000FF">typename</font></b> <font color="#008080">T</font><font color="#990000">,</font> <b><font color="#0000FF">typename</font></b> <font color="#008080">R</font><font color="#990000">,</font> <b><font color="#0000FF">typename</font></b> <font color="#990000">...</font>Args<font color="#990000">,</font> <b><font color="#000000">R</font></b> <font color="#990000">(</font>T<font color="#990000">::*</font>mf<font color="#990000">)(</font>Args<font color="#990000">...)</font> <b><font color="#0000FF">const</font></b><font color="#990000">&gt;</font>
<b><font color="#0000FF">struct</font></b> <font color="#008080">internal_member_function_traits</font><font color="#990000">&lt;</font><b><font color="#000000">R</font></b> <font color="#990000">(</font>T<font color="#990000">::*)(</font>Args<font color="#990000">...)</font> <b><font color="#0000FF">const</font></b><font color="#990000">,</font> mf<font color="#990000">&gt;</font>
<font color="#FF0000">{</font>
	<b><font color="#0000FF">typedef</font></b> <b><font color="#000000">R</font></b> <font color="#990000">(</font>this_as_ref_function_signature<font color="#990000">)(</font><b><font color="#0000FF">const</font></b> T<font color="#990000">&amp;,</font> Args <font color="#990000">...</font> args<font color="#990000">);</font>
    <b><font color="#0000FF">static</font></b> <font color="#008080">R</font> <b><font color="#000000">this_as_ref</font></b><font color="#990000">(</font><b><font color="#0000FF">const</font></b> T<font color="#990000">&amp;</font> first<font color="#990000">,</font> Args <font color="#990000">...</font> args<font color="#990000">)</font>
    <font color="#FF0000">{</font>
        <b><font color="#0000FF">return</font></b> <font color="#990000">(</font>first<font color="#990000">.*</font>mf<font color="#990000">)(</font>std<font color="#990000">::</font>forward<font color="#990000">&lt;</font>Args<font color="#990000">&gt;(</font>args<font color="#990000">)...);</font>
    <font color="#FF0000">}</font>
<font color="#FF0000">}</font><font color="#990000">;</font>

<b><font color="#0000FF">template</font></b> <font color="#990000">&lt;</font><b><font color="#0000FF">typename</font></b> <font color="#008080">T</font><font color="#990000">,</font> <b><font color="#0000FF">typename</font></b> <font color="#008080">R</font><font color="#990000">,</font> <b><font color="#0000FF">typename</font></b> <font color="#990000">...</font>Args<font color="#990000">,</font> <b><font color="#000000">R</font></b> <font color="#990000">(</font>T<font color="#990000">::*</font>mf<font color="#990000">)(</font>Args<font color="#990000">...)</font> <b><font color="#0000FF">noexcept</font></b><font color="#990000">&gt;</font>
<b><font color="#0000FF">struct</font></b> <font color="#008080">internal_member_function_traits</font><font color="#990000">&lt;</font><b><font color="#000000">R</font></b> <font color="#990000">(</font>T<font color="#990000">::*)(</font>Args<font color="#990000">...)</font> <b><font color="#0000FF">noexcept</font></b><font color="#990000">,</font> mf<font color="#990000">&gt;</font>
<font color="#FF0000">{</font>
	<b><font color="#0000FF">typedef</font></b> <b><font color="#000000">R</font></b> <font color="#990000">(</font>this_as_ref_function_signature<font color="#990000">)(</font>T<font color="#990000">&amp;,</font> Args <font color="#990000">...</font> args<font color="#990000">)</font> <b><font color="#0000FF">noexcept</font></b><font color="#990000">;</font>
    <b><font color="#0000FF">static</font></b> <font color="#008080">R</font> <b><font color="#000000">this_as_ref</font></b><font color="#990000">(</font>T<font color="#990000">&amp;</font> first<font color="#990000">,</font> Args <font color="#990000">...</font> args<font color="#990000">)</font> <b><font color="#0000FF">noexcept</font></b>
    <font color="#FF0000">{</font>
        <b><font color="#0000FF">return</font></b> <font color="#990000">(</font>first<font color="#990000">.*</font>mf<font color="#990000">)(</font>std<font color="#990000">::</font>forward<font color="#990000">&lt;</font>Args<font color="#990000">&gt;(</font>args<font color="#990000">)...);</font>
    <font color="#FF0000">}</font>
<font color="#FF0000">}</font><font color="#990000">;</font>

<b><font color="#0000FF">template</font></b> <font color="#990000">&lt;</font><b><font color="#0000FF">typename</font></b> <font color="#008080">T</font><font color="#990000">,</font> <b><font color="#0000FF">typename</font></b> <font color="#008080">R</font><font color="#990000">,</font> <b><font color="#0000FF">typename</font></b> <font color="#990000">...</font>Args<font color="#990000">,</font> <b><font color="#000000">R</font></b> <font color="#990000">(</font>T<font color="#990000">::*</font>mf<font color="#990000">)(</font>Args<font color="#990000">...)</font> <b><font color="#0000FF">const</font></b> <b><font color="#0000FF">noexcept</font></b><font color="#990000">&gt;</font>
<b><font color="#0000FF">struct</font></b> <font color="#008080">internal_member_function_traits</font><font color="#990000">&lt;</font><b><font color="#000000">R</font></b> <font color="#990000">(</font>T<font color="#990000">::*)(</font>Args<font color="#990000">...)</font> <b><font color="#0000FF">const</font></b> <b><font color="#0000FF">noexcept</font></b><font color="#990000">,</font> mf<font color="#990000">&gt;</font>
<font color="#FF0000">{</font>
	<b><font color="#0000FF">typedef</font></b> <b><font color="#000000">R</font></b> <font color="#990000">(</font>this_as_ref_function_signature<font color="#990000">)(</font><b><font color="#0000FF">const</font></b> T<font color="#990000">&amp;,</font> Args <font color="#990000">...</font> args<font color="#990000">)</font> <b><font color="#0000FF">noexcept</font></b><font color="#990000">;</font>
    <b><font color="#0000FF">static</font></b> <font color="#008080">R</font> <b><font color="#000000">this_as_ref</font></b><font color="#990000">(</font><b><font color="#0000FF">const</font></b> T<font color="#990000">&amp;</font> first<font color="#990000">,</font> Args <font color="#990000">...</font> args<font color="#990000">)</font> <b><font color="#0000FF">noexcept</font></b>
    <font color="#FF0000">{</font>
        <b><font color="#0000FF">return</font></b> <font color="#990000">(</font>first<font color="#990000">.*</font>mf<font color="#990000">)(</font>std<font color="#990000">::</font>forward<font color="#990000">&lt;</font>Args<font color="#990000">&gt;(</font>args<font color="#990000">)...);</font>
    <font color="#FF0000">}</font>
<font color="#FF0000">}</font><font color="#990000">;</font>

<b><font color="#0000FF">template</font></b><font color="#990000">&lt;</font><b><font color="#0000FF">auto</font></b> MFP<font color="#990000">&gt;</font>
<b><font color="#0000FF">using</font></b> member_function_traits <font color="#990000">=</font> internal_member_function_traits<font color="#990000">&lt;</font><b><font color="#0000FF">decltype</font></b><font color="#990000">(</font>MFP<font color="#990000">),</font> MFP<font color="#990000">&gt;;</font>

<font color="#009900">int</font> <b><font color="#000000">main</font></b><font color="#990000">()</font>
<font color="#FF0000">{</font>
    <font color="#008080">bar</font> b<font color="#990000">;</font>
    <i><font color="#9A1900">// currently allowed initialization of member function pointer</font></i>
    <font color="#009900">void</font> <font color="#990000">(</font>bar<font color="#990000">::*</font>mfp1<font color="#990000">)(</font><font color="#009900">bool</font><font color="#990000">,</font> <font color="#009900">int</font><font color="#990000">,</font> <font color="#009900">float</font><font color="#990000">)</font> <b><font color="#0000FF">noexcept</font></b><font color="#990000">(</font><b><font color="#0000FF">false</font></b><font color="#990000">)</font> <font color="#990000">=</font> <b><font color="#0000FF">static_cast</font></b><font color="#990000">&lt;</font><font color="#009900">void</font> <font color="#990000">(</font>bar<font color="#990000">::*)(</font><font color="#009900">bool</font><font color="#990000">,</font> <font color="#009900">int</font><font color="#990000">,</font> <font color="#009900">float</font><font color="#990000">)</font> <b><font color="#0000FF">noexcept</font></b><font color="#990000">(</font><b><font color="#0000FF">false</font></b><font color="#990000">)&gt;(&amp;</font>bar<font color="#990000">::</font>baz<font color="#990000">);</font>
    <font color="#009900">void</font> <font color="#990000">(</font>bar<font color="#990000">::*</font>mfp2<font color="#990000">)(</font><font color="#009900">bool</font><font color="#990000">,</font> <font color="#009900">int</font><font color="#990000">,</font> <font color="#009900">float</font><font color="#990000">)</font> <b><font color="#0000FF">const</font></b> <b><font color="#0000FF">noexcept</font></b><font color="#990000">(</font><b><font color="#0000FF">false</font></b><font color="#990000">)</font> <font color="#990000">=</font> <b><font color="#0000FF">static_cast</font></b><font color="#990000">&lt;</font><font color="#009900">void</font> <font color="#990000">(</font>bar<font color="#990000">::*)(</font><font color="#009900">bool</font><font color="#990000">,</font> <font color="#009900">int</font><font color="#990000">,</font> <font color="#009900">float</font><font color="#990000">)</font> <b><font color="#0000FF">const</font></b> <b><font color="#0000FF">noexcept</font></b><font color="#990000">(</font><b><font color="#0000FF">false</font></b><font color="#990000">)&gt;(&amp;</font>bar<font color="#990000">::</font>baz<font color="#990000">);</font>
    <font color="#009900">void</font> <font color="#990000">(</font>bar<font color="#990000">::*</font>mfp3<font color="#990000">)(</font><font color="#009900">bool</font><font color="#990000">,</font> <font color="#009900">int</font><font color="#990000">,</font> <font color="#009900">float</font><font color="#990000">)</font> <b><font color="#0000FF">noexcept</font></b><font color="#990000">(</font><b><font color="#0000FF">true</font></b><font color="#990000">)</font> <font color="#990000">=</font> <b><font color="#0000FF">static_cast</font></b><font color="#990000">&lt;</font><font color="#009900">void</font><font color="#990000">(</font>bar<font color="#990000">::*)(</font><font color="#009900">bool</font> b<font color="#990000">,</font> <font color="#009900">int</font> i<font color="#990000">,</font> <font color="#009900">float</font> f<font color="#990000">)</font> <b><font color="#0000FF">noexcept</font></b><font color="#990000">(</font><b><font color="#0000FF">true</font></b><font color="#990000">)&gt;(&amp;</font>bar<font color="#990000">::</font>buz<font color="#990000">);</font>
    <font color="#009900">void</font> <font color="#990000">(</font>bar<font color="#990000">::*</font>mfp4<font color="#990000">)(</font><font color="#009900">bool</font><font color="#990000">,</font> <font color="#009900">int</font><font color="#990000">,</font> <font color="#009900">float</font><font color="#990000">)</font> <b><font color="#0000FF">const</font></b> <b><font color="#0000FF">noexcept</font></b><font color="#990000">(</font><b><font color="#0000FF">true</font></b><font color="#990000">)</font> <font color="#990000">=</font> <b><font color="#0000FF">static_cast</font></b><font color="#990000">&lt;</font><font color="#009900">void</font><font color="#990000">(</font>bar<font color="#990000">::*)(</font><font color="#009900">bool</font> b<font color="#990000">,</font> <font color="#009900">int</font> i<font color="#990000">,</font> <font color="#009900">float</font> f<font color="#990000">)</font> <b><font color="#0000FF">const</font></b> <b><font color="#0000FF">noexcept</font></b><font color="#990000">(</font><b><font color="#0000FF">true</font></b><font color="#990000">)&gt;(&amp;</font>bar<font color="#990000">::</font>buz<font color="#990000">);</font>
    <i><font color="#9A1900">// currently allowed initialization of function pointer</font></i>
    <font color="#009900">void</font> <font color="#990000">(*</font>fp1<font color="#990000">)(</font>bar<font color="#990000">&amp;,</font> <font color="#009900">bool</font><font color="#990000">,</font> <font color="#009900">int</font><font color="#990000">,</font> <font color="#009900">float</font><font color="#990000">)</font> <b><font color="#0000FF">noexcept</font></b><font color="#990000">(</font><b><font color="#0000FF">false</font></b><font color="#990000">)</font> <font color="#990000">=</font> <b><font color="#0000FF">static_cast</font></b><font color="#990000">&lt;</font><font color="#009900">void</font> <font color="#990000">(*)(</font>bar<font color="#990000">&amp;,</font> <font color="#009900">bool</font><font color="#990000">,</font> <font color="#009900">int</font><font color="#990000">,</font> <font color="#009900">float</font><font color="#990000">)</font> <b><font color="#0000FF">noexcept</font></b><font color="#990000">(</font><b><font color="#0000FF">false</font></b><font color="#990000">)&gt;(</font>free_bar_baz<font color="#990000">);</font>
    <font color="#009900">void</font> <font color="#990000">(*</font>fp2<font color="#990000">)(</font><b><font color="#0000FF">const</font></b> bar<font color="#990000">&amp;,</font> <font color="#009900">bool</font><font color="#990000">,</font> <font color="#009900">int</font><font color="#990000">,</font> <font color="#009900">float</font><font color="#990000">)</font> <b><font color="#0000FF">noexcept</font></b><font color="#990000">(</font><b><font color="#0000FF">false</font></b><font color="#990000">)</font> <font color="#990000">=</font> <b><font color="#0000FF">static_cast</font></b><font color="#990000">&lt;</font><font color="#009900">void</font> <font color="#990000">(*)(</font><b><font color="#0000FF">const</font></b> bar<font color="#990000">&amp;,</font> <font color="#009900">bool</font><font color="#990000">,</font> <font color="#009900">int</font><font color="#990000">,</font> <font color="#009900">float</font><font color="#990000">)</font> <b><font color="#0000FF">noexcept</font></b><font color="#990000">(</font><b><font color="#0000FF">false</font></b><font color="#990000">)&gt;(</font>free_bar_baz<font color="#990000">);</font>
    <font color="#009900">void</font> <font color="#990000">(*</font>fp3<font color="#990000">)(</font>bar<font color="#990000">&amp;,</font> <font color="#009900">bool</font><font color="#990000">,</font> <font color="#009900">int</font><font color="#990000">,</font> <font color="#009900">float</font><font color="#990000">)</font> <b><font color="#0000FF">noexcept</font></b><font color="#990000">(</font><b><font color="#0000FF">true</font></b><font color="#990000">)</font> <font color="#990000">=</font> <b><font color="#0000FF">static_cast</font></b><font color="#990000">&lt;</font><font color="#009900">void</font><font color="#990000">(*)(</font>bar<font color="#990000">&amp;,</font> <font color="#009900">bool</font> b<font color="#990000">,</font> <font color="#009900">int</font> i<font color="#990000">,</font> <font color="#009900">float</font> f<font color="#990000">)</font> <b><font color="#0000FF">noexcept</font></b><font color="#990000">(</font><b><font color="#0000FF">true</font></b><font color="#990000">)&gt;(</font>free_bar_buz<font color="#990000">);</font>
    <font color="#009900">void</font> <font color="#990000">(*</font>fp4<font color="#990000">)(</font><b><font color="#0000FF">const</font></b> bar<font color="#990000">&amp;,</font> <font color="#009900">bool</font><font color="#990000">,</font> <font color="#009900">int</font><font color="#990000">,</font> <font color="#009900">float</font><font color="#990000">)</font> <b><font color="#0000FF">noexcept</font></b><font color="#990000">(</font><b><font color="#0000FF">true</font></b><font color="#990000">)</font> <font color="#990000">=</font> <b><font color="#0000FF">static_cast</font></b><font color="#990000">&lt;</font><font color="#009900">void</font><font color="#990000">(*)(</font><b><font color="#0000FF">const</font></b> bar<font color="#990000">&amp;,</font> <font color="#009900">bool</font> b<font color="#990000">,</font> <font color="#009900">int</font> i<font color="#990000">,</font> <font color="#009900">float</font> f<font color="#990000">)</font> <b><font color="#0000FF">noexcept</font></b><font color="#990000">(</font><b><font color="#0000FF">true</font></b><font color="#990000">)&gt;(</font>free_bar_buz<font color="#990000">);</font>
    <i><font color="#9A1900">// currently disallowed but DESIRED initialization of function pointer via member function pointer initializer</font></i>
    <i><font color="#9A1900">// example error: address of overloaded function 'baz' cannot be static_cast to type 'void (*)(bar &amp;, bool, int, float) noexcept(false)'</font></i>
    <i><font color="#9A1900">//void (*fp5)(bar&amp;, bool, int, float) noexcept(false) = static_cast&lt;void (*)(bar&amp;, bool, int, float) noexcept(false)&gt;(&amp;bar::baz);</font></i>
    <i><font color="#9A1900">//void (*fp6)(const bar&amp;, bool, int, float) noexcept(false) = static_cast&lt;void (*)(const bar&amp;, bool, int, float) noexcept(false)&gt;(&amp;bar::baz);</font></i>
    <i><font color="#9A1900">//void (*fp7)(bar&amp;, bool, int, float) noexcept(true) = static_cast&lt;void(*)(bar&amp;, bool b, int i, float f) noexcept(true)&gt;(&amp;bar::buz);</font></i>
    <i><font color="#9A1900">//void (*fp8)(const bar&amp;, bool, int, float) noexcept(true) = static_cast&lt;void(*)(const bar&amp;, bool b, int i, float f) noexcept(true)&gt;(&amp;bar::buz);</font></i>
    <i><font color="#9A1900">// just be clear this is NOT DESIRED, NOT BEING ASKED FOR, because it doesn't make sense</font></i>
    <i><font color="#9A1900">// and seems to be impossible since</font></i>
    <i><font color="#9A1900">// member function pointer is dependent upon an instance in order to lookup the function</font></i>
    <i><font color="#9A1900">// example error: cannot cast from type 'void (bar::*)(bool, int, float) noexcept(false)' to pointer type 'void (*)(bar &amp;, bool, int, float) noexcept(false)'</font></i>
    <i><font color="#9A1900">//void (*fp9)(bar&amp;, bool, int, float) noexcept(false) = static_cast&lt;void (*)(bar&amp;, bool, int, float) noexcept(false)&gt;(mfp1);</font></i>
    <i><font color="#9A1900">//void (*fp10)(const bar&amp;, bool, int, float) noexcept(false) = static_cast&lt;void (*)(const bar&amp;, bool, int, float) noexcept(false)&gt;(mfp2);</font></i>
    <i><font color="#9A1900">//void (*fp11)(bar&amp;, bool, int, float) noexcept(true) = static_cast&lt;void(*)(bar&amp;, bool b, int i, float f) noexcept(true)&gt;(mfp3);</font></i>
    <i><font color="#9A1900">//void (*fp12)(const bar&amp;, bool, int, float) noexcept(true) = static_cast&lt;void(*)(const bar&amp;, bool b, int i, float f) noexcept(true)&gt;(mfp4);</font></i>
    <i><font color="#9A1900">// binding via templates</font></i>
    <font color="#009900">void</font> <font color="#990000">(*</font>fp5<font color="#990000">)(</font>bar<font color="#990000">&amp;,</font> <font color="#009900">bool</font><font color="#990000">,</font> <font color="#009900">int</font><font color="#990000">,</font> <font color="#009900">float</font><font color="#990000">)</font> <b><font color="#0000FF">noexcept</font></b><font color="#990000">(</font><b><font color="#0000FF">false</font></b><font color="#990000">)</font> <font color="#990000">=</font> member_function_traits<font color="#990000">&lt;</font><b><font color="#0000FF">static_cast</font></b><font color="#990000">&lt;</font><font color="#009900">void</font> <font color="#990000">(</font>bar<font color="#990000">::*)(</font><font color="#009900">bool</font><font color="#990000">,</font> <font color="#009900">int</font><font color="#990000">,</font> <font color="#009900">float</font><font color="#990000">)</font> <b><font color="#0000FF">noexcept</font></b><font color="#990000">(</font><b><font color="#0000FF">false</font></b><font color="#990000">)&gt;(&amp;</font>bar<font color="#990000">::</font>baz<font color="#990000">)&gt;::</font>this_as_ref<font color="#990000">;</font>
    <font color="#009900">void</font> <font color="#990000">(*</font>fp6<font color="#990000">)(</font><b><font color="#0000FF">const</font></b> bar<font color="#990000">&amp;,</font> <font color="#009900">bool</font><font color="#990000">,</font> <font color="#009900">int</font><font color="#990000">,</font> <font color="#009900">float</font><font color="#990000">)</font> <b><font color="#0000FF">noexcept</font></b><font color="#990000">(</font><b><font color="#0000FF">false</font></b><font color="#990000">)</font> <font color="#990000">=</font> member_function_traits<font color="#990000">&lt;</font><b><font color="#0000FF">static_cast</font></b><font color="#990000">&lt;</font><font color="#009900">void</font> <font color="#990000">(</font>bar<font color="#990000">::*)(</font><font color="#009900">bool</font><font color="#990000">,</font> <font color="#009900">int</font><font color="#990000">,</font> <font color="#009900">float</font><font color="#990000">)</font> <b><font color="#0000FF">const</font></b> <b><font color="#0000FF">noexcept</font></b><font color="#990000">(</font><b><font color="#0000FF">false</font></b><font color="#990000">)&gt;(&amp;</font>bar<font color="#990000">::</font>baz<font color="#990000">)&gt;::</font>this_as_ref<font color="#990000">;</font>
    <font color="#009900">void</font> <font color="#990000">(*</font>fp7<font color="#990000">)(</font>bar<font color="#990000">&amp;,</font> <font color="#009900">bool</font><font color="#990000">,</font> <font color="#009900">int</font><font color="#990000">,</font> <font color="#009900">float</font><font color="#990000">)</font> <b><font color="#0000FF">noexcept</font></b><font color="#990000">(</font><b><font color="#0000FF">true</font></b><font color="#990000">)</font> <font color="#990000">=</font> member_function_traits<font color="#990000">&lt;</font><b><font color="#0000FF">static_cast</font></b><font color="#990000">&lt;</font><font color="#009900">void</font><font color="#990000">(</font>bar<font color="#990000">::*)(</font><font color="#009900">bool</font> b<font color="#990000">,</font> <font color="#009900">int</font> i<font color="#990000">,</font> <font color="#009900">float</font> f<font color="#990000">)</font> <b><font color="#0000FF">noexcept</font></b><font color="#990000">(</font><b><font color="#0000FF">true</font></b><font color="#990000">)&gt;(&amp;</font>bar<font color="#990000">::</font>buz<font color="#990000">)&gt;::</font>this_as_ref<font color="#990000">;</font>
    <font color="#009900">void</font> <font color="#990000">(*</font>fp8<font color="#990000">)(</font><b><font color="#0000FF">const</font></b> bar<font color="#990000">&amp;,</font> <font color="#009900">bool</font><font color="#990000">,</font> <font color="#009900">int</font><font color="#990000">,</font> <font color="#009900">float</font><font color="#990000">)</font> <b><font color="#0000FF">noexcept</font></b><font color="#990000">(</font><b><font color="#0000FF">true</font></b><font color="#990000">)</font> <font color="#990000">=</font> member_function_traits<font color="#990000">&lt;</font><b><font color="#0000FF">static_cast</font></b><font color="#990000">&lt;</font><font color="#009900">void</font><font color="#990000">(</font>bar<font color="#990000">::*)(</font><font color="#009900">bool</font> b<font color="#990000">,</font> <font color="#009900">int</font> i<font color="#990000">,</font> <font color="#009900">float</font> f<font color="#990000">)</font> <b><font color="#0000FF">const</font></b> <b><font color="#0000FF">noexcept</font></b><font color="#990000">(</font><b><font color="#0000FF">true</font></b><font color="#990000">)&gt;(&amp;</font>bar<font color="#990000">::</font>buz<font color="#990000">)&gt;::</font>this_as_ref<font color="#990000">;</font>
<font color="#FF0000">}</font></tt></pre>

</div>
<!--
<p>Here, I demonstrated the desired usage via the explicit static_cast. This proposal is focused on the explicit cast in order to restore this missing functionality. Explicit is required regardless in order to allow the end user to resolve overloads, as demonstrated. It is my believe that explicit cast would not be a breaking change. However if compilers can implement this proposal as a C cast and/or implicit cast than that could also make things easier for direct users versus library writers who would use this in their private implementations. The important thing is to restore the missing functionality.</p>
<h2 id="why">Why bother? What do we gain?</h2>
<ol>
<li>sanding of some rough edges of C++ by making it more uniform and consistent</li>
<li>completing some unfinished work that is as old as C++ itself</li>
<li>undoing a bifurcation when member function pointers were standardized</li>
<li>restoring the power of free function pointers back to the C and proto C++ era</li>
<li>unified function pointers; free functions can reference free and member functions; argument dependent lookup is less of an issue when you are explicitly telling which function is to be selected</li>
<li>There is no need for the end user to create a binder to convert a member function into a free function effectively tying the object oriented and functional paradigms back together.</li>
<li>No need to resort to templates to provide something the core language is already providing in other places in C++ thus making things even easier.</li>
</ol>
<p>Concerning the last two, the "// binding via templates" portion of the example illustrates what library writers and end users have to do today to work around this limitation. Even if the explicit template example can be reduced with an implicit auto... solution, it would still be a verbose unintuitive resolution that depends on templates unnecessarily.</p>
-->
<!--
<h2 id="acknowledgments">Acknowledgments</h2>
<p>Thanks to TODO and TODOfor providing very valuable feedback on earlier drafts of this proposal.</p>
-->
<!--
<h2 id="faq">Frequently Asked Questions</h2>
<h3 id="ecx">What about ECX?</h3>
<p>In Microsoft C++ compilers, the this pointer is stored in the ECX register when calling a member function instead of being passed on the stack. Worse case a C++ compiler would need to provide both implementations or one calling the other. One implementation could be elided based on end user usage patterns. In reality this is little different than an inline function. A function could be kept around if the function was ever assigned to a function pointer and in other cases the stack frame could be elided altogether. Further, any compiler can choose to store any parameter in a register. Compiler optimizations should not limit the reasonable functionality provided by the language.</p>
<h3 id="deducing-this">How does this relate to <a href="#reference-deducing-this">Deducing this</a>?</h3>
<p>In Deducing this, deducing this member functions are implicit cast to function pointers already and do not cast implicitly or explicitly to member function pointers. So in reality there is no change. This proposal would actually be complimentary in that regard and even more so if this proposed explicit cast could be made implicit without any breaking changes. The only difference is the type of this pointer in the free function. In this proposal it would be a variation of a reference always. In deducing this, there is the option of it be a value, especially for small types.</p>
<h3 id="void">How might this combine with composite void*/guaranteed inlining?</h3>
<p>A future proposal, composite void*, would explore enhancing void* conversions in more advanced aggregated types. One variation of this would allow function pointers with pointers and/or lvalue references to be cast to other function pointers with those pointers and references being swapped out with a void pointer and still be callable without any undefined behavior. This proposal would be complementary with such a future proposal allowing simple type erased pointers to member functions.</p>
-->
<h2 id="references">References</h2>
<span id="reference-dmc">c++ - How are member function pointers implemented by DMC?</span><br/>
&nbsp;&nbsp;&nbsp;<a href="https://www.digitalmars.com/archives/cplusplus/3802.html" target="__blank">https://www.digitalmars.com/archives/cplusplus/3802.html</a><br/>
<br/>
<span id="reference-obscure">Obscure C++ Features</span><br/>
&nbsp;&nbsp;&nbsp;<a href="http://madebyevan.com/obscure-cpp-features/" target="__blank">http://madebyevan.com/obscure-cpp-features/</a><br/>
<br/>
<span id="reference-fastest">Member Function Pointers and the Fastest Possible C++ Delegates</span><br/>
&nbsp;&nbsp;&nbsp;<a href="https://www.codeproject.com/Articles/7150/Member-Function-Pointers-and-the-Fastest-Possible" target="__blank">https://www.codeproject.com/Articles/7150/Member-Function-Pointers-and-the-Fastest-Possible</a><br/>
<br/>
<span id="reference-generic_member_function_pointer_as_a_template_parameter">generic member function pointer as a template parameter</span><br/>
&nbsp;&nbsp;&nbsp;<a href="https://stackoverflow.com/questions/9779105/generic-member-function-pointer-as-a-template-parameter" target="__blank">https://stackoverflow.com/questions/9779105/generic-member-function-pointer-as-a-template-parameter</a><br/>
<br/>
<span id="reference-deducing-this">Deducing this</span><br/>
&nbsp;&nbsp;&nbsp;<a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p0847r7.html" target="__blank">http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p0847r7.html</a><br/>
<br/>
</body>
</html>
